name: Security ZAP Baseline

on:
  workflow_dispatch:
  pull_request:
    paths:
      - 'apps/admin/**'
      - 'packages/api/**'
      - '.github/workflows/security-zap.yml'
      - 'docs/security/**'
  schedule:
    - cron: '0 7 * * 3'

permissions:
  contents: read

jobs:
  zap-admin:
    name: ZAP Baseline - Admin
    runs-on: ubuntu-latest
    if: ${{ secrets.ZAP_TARGET_ADMIN_URL != '' }}
    steps:
      - name: ZAP Baseline Admin
        uses: zaproxy/action-baseline@v0.12.0
        with:
          target: ${{ secrets.ZAP_TARGET_ADMIN_URL }}
          fail_action: true
          cmd_options: '-a -j -m 5'

  zap-api:
    name: ZAP Baseline - API
    runs-on: ubuntu-latest
    if: ${{ secrets.ZAP_TARGET_API_URL != '' }}
    steps:
      - name: ZAP Baseline API
        uses: zaproxy/action-baseline@v0.12.0
        with:
          target: ${{ secrets.ZAP_TARGET_API_URL }}
          fail_action: true
          cmd_options: '-a -j -m 5'
